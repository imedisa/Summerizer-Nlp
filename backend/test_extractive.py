from extractive import textrank_summarize, summarize_from_file
import os


def test_with_sample_text():
    """ØªØ³Øª Ø¨Ø§ ÛŒÚ© Ù…ØªÙ† Ù†Ù…ÙˆÙ†Ù‡"""
    print("=" * 80)
    print("ØªØ³Øª Û±: Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØªÙ† Ù†Ù…ÙˆÙ†Ù‡")
    print("=" * 80)
    
    text = """
    Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ù‡Ù…â€ŒØªØ±ÛŒÙ† ÙÙ†Ø§ÙˆØ±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù‚Ø±Ù† Ø¨ÛŒØ³Øªâ€ŒÙˆÛŒÚ©Ù… Ø§Ø³Øª. 
    Ø§ÛŒÙ† ÙÙ†Ø§ÙˆØ±ÛŒ ØªÙˆØ§Ù†Ø³ØªÙ‡ Ø§Ø³Øª Ø¯Ø± Ø­ÙˆØ²Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„ÙÛŒ Ù…Ø§Ù†Ù†Ø¯ Ù¾Ø²Ø´Ú©ÛŒØŒ ØµÙ†Ø¹Øª Ùˆ Ø¢Ù…ÙˆØ²Ø´ ØªØ­ÙˆÙ„ Ø§ÛŒØ¬Ø§Ø¯ Ú©Ù†Ø¯.
    Ú¯ÙˆÚ¯Ù„ Ø§Ø®ÛŒØ±Ø§Ù‹ Ù…Ø¯Ù„ Ø²Ø¨Ø§Ù†ÛŒ Ø¬Ø¯ÛŒØ¯ Ø®ÙˆØ¯ Ø¨Ù‡ Ù†Ø§Ù… Ø¬Ù…ÛŒÙ†Ø§ÛŒ Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ú©Ø±Ø¯ Ú©Ù‡ Ù‚Ø§Ø¨Ù„ÛŒØª Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù‡Ù…Ø²Ù…Ø§Ù† Ù…ØªÙ†ØŒ ØªØµÙˆÛŒØ± Ùˆ ØµØ¯Ø§ Ø±Ø§ Ø¯Ø§Ø±Ø¯.
    Ø¯Ø± Ø§ÛŒØ±Ø§Ù† Ù†ÛŒØ² Ø§Ø³ØªØ§Ø±ØªØ§Ù¾â€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„ÙÛŒ Ø¯Ø± Ø­ÙˆØ²Ù‡ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ ÙØ§Ø±Ø³ÛŒ ÙØ¹Ø§Ù„ÛŒØª Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯ Ùˆ Ù…Ø­ØµÙˆÙ„Ø§ØªÛŒ Ù…Ø§Ù†Ù†Ø¯ Ú†Øªâ€ŒØ¨Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ø±Ø§Ø¦Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡Ù†Ø¯.
    Ú©Ø§Ø±Ø´Ù†Ø§Ø³Ø§Ù† Ù…Ø¹ØªÙ‚Ø¯Ù†Ø¯ Ú©Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªØ§ Ø³Ø§Ù„ Û²Û°Û³Û° Ø¨ÛŒØ´ Ø§Ø² Û±Ûµ Ø¯Ø±ØµØ¯ Ø§Ø² ØªÙˆÙ„ÛŒØ¯ Ù†Ø§Ø®Ø§Ù„Øµ Ø¯Ø§Ø®Ù„ÛŒ Ø¬Ù‡Ø§Ù† Ø±Ø§ ØªØ­Øª ØªØ£Ø«ÛŒØ± Ù‚Ø±Ø§Ø± Ø®ÙˆØ§Ù‡Ø¯ Ø¯Ø§Ø¯.
    Ø¨Ø§ Ø§ÛŒÙ† Ø­Ø§Ù„ØŒ Ù†Ú¯Ø±Ø§Ù†ÛŒâ€ŒÙ‡Ø§ÛŒÛŒ Ø¯Ø±Ø¨Ø§Ø±Ù‡ Ø§Ø®Ù„Ø§Ù‚ Ùˆ Ø§Ù…Ù†ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§ÛŒÙ† ÙÙ†Ø§ÙˆØ±ÛŒâ€ŒÙ‡Ø§ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯.
    Ø¯ÙˆÙ„Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù Ø¯Ø± Ø­Ø§Ù„ ØªØ¯ÙˆÛŒÙ† Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ù…Ù‚Ø±Ø±Ø§Øª Ø¨Ø±Ø§ÛŒ Ù†Ø¸Ø§Ø±Øª Ø¨Ø± ØªÙˆØ³Ø¹Ù‡ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù‡Ø³ØªÙ†Ø¯.
    Ù…Ø­Ù‚Ù‚Ø§Ù† Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¨Ø± Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø´ÙØ§ÙÛŒØª Ø¯Ø± Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ…â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù…Ø§Ø´ÛŒÙ† ØªØ£Ú©ÛŒØ¯ Ø¯Ø§Ø±Ù†Ø¯.
    """
    
    # ØªØ³Øª Ø¨Ø§ Ù†Ø³Ø¨Øª 30%
    result = textrank_summarize(text, summary_ratio=0.3)
    print_result(result)
    
    # ØªØ³Øª Ø¨Ø§ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ù‚ÛŒÙ‚ Ø¬Ù…Ù„Ø§Øª
    print("\n" + "-" * 80)
    print("ØªØ³Øª Ø¨Ø§ ØªØ¹Ø¯Ø§Ø¯ Ø¯Ù‚ÛŒÙ‚ 3 Ø¬Ù…Ù„Ù‡:")
    print("-" * 80)
    result2 = textrank_summarize(text, num_sentences=3)
    print_result(result2)


def test_with_file():
    """ØªØ³Øª Ø¨Ø§ ÙØ§ÛŒÙ„ sample_texts.txt"""
    print("\n" + "=" * 80)
    print("ØªØ³Øª Û²: Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø² ÙØ§ÛŒÙ„")
    print("=" * 80)
    
    file_path = "sample_texts.txt"
    
    if not os.path.exists(file_path):
        print(f"âŒ ÙØ§ÛŒÙ„ {file_path} ÛŒØ§ÙØª Ù†Ø´Ø¯!")
        return
    
    # Ø®ÙˆØ§Ù†Ø¯Ù† Ùˆ Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø®Ø¨Ø±Ù‡Ø§
    with open(file_path, 'r', encoding='utf-8') as f:
        content = f.read()
    
    # Ø¬Ø¯Ø§ Ú©Ø±Ø¯Ù† Ø®Ø¨Ø±Ù‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ === Ø®Ø¨Ø± ===
    news_items = content.split('===')
    
    # ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ùˆ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ
    news_items = [item.strip() for item in news_items if item.strip() and 'Ø®Ø¨Ø±' in item]
    
    for i, news in enumerate(news_items[:3], 1):  # ÙÙ‚Ø· 3 Ø®Ø¨Ø± Ø§ÙˆÙ„
        lines = news.split('\n')
        title = lines[0].strip() if lines else f"Ø®Ø¨Ø± {i}"
        text = '\n'.join(lines[1:]).strip()
        
        if len(text) > 50:  # Ø§Ú¯Ø± Ù…ØªÙ† Ù…Ø¹Ù†Ø§Ø¯Ø§Ø± Ø¯Ø§Ø±Ù‡
            print(f"\n{'â”€' * 80}")
            print(f"ğŸ“° {title}")
            print('â”€' * 80)
            
            result = textrank_summarize(text, summary_ratio=0.3)
            print_result(result, show_original=False)


def test_different_ratios():
    """ØªØ³Øª Ø¨Ø§ Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù"""
    print("\n" + "=" * 80)
    print("ØªØ³Øª Û³: Ù…Ù‚Ø§ÛŒØ³Ù‡ Ù†Ø³Ø¨Øªâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù")
    print("=" * 80)
    
    text = """
    Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ Ø´Ø§Ø®Ù‡â€ŒØ§ÛŒ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ±Ù‡Ø§ Ú©Ù…Ú© Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø²Ø¨Ø§Ù† Ø§Ù†Ø³Ø§Ù†ÛŒ Ø±Ø§ Ø¯Ø±Ú© Ú©Ù†Ù†Ø¯.
    Ø§ÛŒÙ† ÙÙ†Ø§ÙˆØ±ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯Ù‡Ø§ÛŒ Ø²ÛŒØ§Ø¯ÛŒ Ø¯Ø§Ø±Ø¯ Ø§Ø² Ø¬Ù…Ù„Ù‡ ØªØ±Ø¬Ù…Ù‡ Ù…Ø§Ø´ÛŒÙ†ÛŒØŒ ØªØ´Ø®ÛŒØµ Ú¯ÙØªØ§Ø±ØŒ Ùˆ Ù¾Ø§Ø³Ø® Ø¨Ù‡ Ø³ÙˆØ§Ù„Ø§Øª.
    Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ Ù…ØªÙ† ÛŒÚ©ÛŒ Ø§Ø² Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§ÛŒ Ù…Ù‡Ù… Ø¯Ø± Ø§ÛŒÙ† Ø­ÙˆØ²Ù‡ Ø§Ø³Øª.
    Ø¯Ùˆ Ø±ÙˆØ´ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ø¯: Ø§Ø³ØªØ®Ø±Ø§Ø¬ÛŒ Ùˆ Ù…ÙˆÙ„Ø¯.
    Ø±ÙˆØ´ Ø§Ø³ØªØ®Ø±Ø§Ø¬ÛŒ Ø¬Ù…Ù„Ø§Øª Ù…Ù‡Ù… Ø±Ø§ Ø§Ø² Ù…ØªÙ† Ø§ØµÙ„ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
    Ø±ÙˆØ´ Ù…ÙˆÙ„Ø¯ Ø¬Ù…Ù„Ø§Øª Ø¬Ø¯ÛŒØ¯ÛŒ ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ú©Ù‡ Ù…Ø­ØªÙˆØ§ÛŒ Ø§ØµÙ„ÛŒ Ø±Ø§ Ø¨ÛŒØ§Ù† Ù…ÛŒâ€ŒÚ©Ù†Ù†Ø¯.
    Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… TextRank ÛŒÚ©ÛŒ Ø§Ø² Ø±ÙˆØ´â€ŒÙ‡Ø§ÛŒ Ù…Ø­Ø¨ÙˆØ¨ Ø¨Ø±Ø§ÛŒ Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒ Ø§Ø³ØªØ®Ø±Ø§Ø¬ÛŒ Ø§Ø³Øª.
    Ø§ÛŒÙ† Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ø¨Ø± Ù¾Ø§ÛŒÙ‡ PageRank Ú¯ÙˆÚ¯Ù„ Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø§Ø³Øª.
    """
    
    ratios = [0.2, 0.3, 0.5]
    
    for ratio in ratios:
        print(f"\n{'â”€' * 80}")
        print(f"Ù†Ø³Ø¨Øª Ø®Ù„Ø§ØµÙ‡: {ratio:.0%}")
        print('â”€' * 80)
        
        result = textrank_summarize(text, summary_ratio=ratio)
        print(f"ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ø§Øª: {result['num_summary_sentences']} Ø§Ø² {result['num_original_sentences']}")
        print(f"Ø®Ù„Ø§ØµÙ‡: {result['summary']}")


def print_result(result, show_original=True):
    """Ú†Ø§Ù¾ Ù†ØªØ§ÛŒØ¬ Ø¨Ù‡ ØµÙˆØ±Øª Ø²ÛŒØ¨Ø§"""
    if 'error' in result:
        print(f"âŒ Ø®Ø·Ø§: {result['error']}")
        return
    
    if show_original:
        print(f"\nğŸ“„ Ù…ØªÙ† Ø§ØµÙ„ÛŒ:")
        print(result['original_text'].strip()[:200] + "...")
    
    print(f"\nğŸ“Š Ø¢Ù…Ø§Ø±:")
    print(f"  â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ø§Øª Ø§ØµÙ„ÛŒ: {result['num_original_sentences']}")
    print(f"  â€¢ ØªØ¹Ø¯Ø§Ø¯ Ø¬Ù…Ù„Ø§Øª Ø®Ù„Ø§ØµÙ‡: {result['num_summary_sentences']}")
    print(f"  â€¢ Ù†Ø³Ø¨Øª Ø®Ù„Ø§ØµÙ‡: {result['summary_ratio']:.1%}")
    print(f"  â€¢ Ø´Ù…Ø§Ø±Ù‡ Ø¬Ù…Ù„Ø§Øª Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡: {result['selected_indices']}")
    
    print(f"\nâœ¨ Ø®Ù„Ø§ØµÙ‡ Ù†Ù‡Ø§ÛŒÛŒ:")
    print(result['summary'])
    
    print(f"\nğŸ¯ Ø§Ù…ØªÛŒØ§Ø² Ø¬Ù…Ù„Ø§Øª (5 Ø¬Ù…Ù„Ù‡ Ø¨Ø±ØªØ±):")
    sorted_scores = sorted(result['scores'].items(), key=lambda x: x[1], reverse=True)
    for i, (idx, score) in enumerate(sorted_scores[:5], 1):
        print(f"  {i}. Ø¬Ù…Ù„Ù‡ {idx+1}: {score:.4f}")


def run_all_tests():
    """Ø§Ø¬Ø±Ø§ÛŒ ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§"""
    test_with_sample_text()
    test_with_file()
    test_different_ratios()
    
    print("\n" + "=" * 80)
    print("âœ… ØªÙ…Ø§Ù… ØªØ³Øªâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¬Ø±Ø§ Ø´Ø¯Ù†Ø¯!")
    print("=" * 80)


if __name__ == "__main__":
    run_all_tests()
